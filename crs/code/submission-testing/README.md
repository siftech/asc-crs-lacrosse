# Scripts for interfacing with the AIxCC CAPI submission system. 
### Brief Note
*June 12 - Assuming IAPI is deprecated and replaced by CAPI.*
Currently, both IAPI and CAPI containers exist. Both expose port '8080' so 
`curl http://capi:8080/health` and `curl http://iapi:8080/health` return "ok". 
There exists an outdated compose.yaml and run.sh inside of the CAPI repository 
looking at port "8082". For why? who knows. 

Scripts found in this directory are based on run.sh and built to run on the 
current status of the crs-sandbox.
This directory, for now, will reside in the mounted/shared "crs_scratch" directory
with anticipation to be relocacted into a "lax_scratch" directory.

As of 06-13-24, current capi accepts a submission of a the mock cp with this submit-test.sh script. 


hs.sh:
- Health check.
- Expected out = "ok".
- Saves health status in capi-health.json and iapi-health.json. <-- could remove to de-bloat. 

submit-test.sh: 
- Runs health check. 
- Submits vds from a lacrosse generated vds input .json file. (Uses vds-test-sub.json as input.)
- Expected output of a <cp_name>-vds-out.json with an "accepted" vds submission.  
- Upon an accepted vds submission, curls the vds endpoint for a cpv_uuid.
- Uses cpv_uuid and a lacrosse generated .patch file to submitted gp to gp endpoint.
  - Converts the .patch file to base64 with line wrapping disabled.
- Expected output of a <cp_name>-gp-out.json with an "accepted" gp submission.

vds-test-sub.json
- Currently populated with json of a mock cp vds submission example. 
- Ideally, at competition time, a file with json generated by lacrosse?
- Contains the following: 
  - cp_name : name of the challenge problem. 
  - pou : 
    - commit_sha1 : sha1 of the git commit introducing the vuln. 
    - sanitizer : idenity of the triggered sanitizer (i.e "id_1"). 
  - pov : 
    - harness : identity of the harness defined in the challenge problems project.yaml (i.e "id_1"). 
    - data : base64 of blob file responsible for triggering the sanitizer (i.e "./run.sh run_pov "blob_file" "harness"")

mockcp-test-patch.patch
- git diff of generated patch to fix the mock cp
- This file will be converted to a base64 string and submitted to the gp endpoint.

TODO:
Clean up. 



